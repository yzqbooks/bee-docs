"use strict";(self.webpackChunkbee=self.webpackChunkbee||[]).push([[6121],{3905:function(e,r,n){n.d(r,{Zo:function(){return u},kt:function(){return c}});var t=n(7294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function l(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function o(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?l(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function i(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},l=Object.keys(e);for(t=0;t<l.length;t++)n=l[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)n=l[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var m=t.createContext({}),s=function(e){var r=t.useContext(m),n=r;return e&&(n="function"==typeof e?e(r):o(o({},r),e)),n},u=function(e){var r=s(e.components);return t.createElement(m.Provider,{value:r},e.children)},p={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},d=t.forwardRef((function(e,r){var n=e.components,a=e.mdxType,l=e.originalType,m=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=s(n),c=a,g=d["".concat(m,".").concat(c)]||d[c]||p[c]||l;return n?t.createElement(g,o(o({ref:r},u),{},{components:n})):t.createElement(g,o({ref:r},u))}));function c(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=d;var i={};for(var m in r)hasOwnProperty.call(r,m)&&(i[m]=r[m]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var s=2;s<l;s++)o[s]=n[s];return t.createElement.apply(null,o)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1152:function(e,r,n){n.r(r),n.d(r,{assets:function(){return u},contentTitle:function(){return m},default:function(){return c},frontMatter:function(){return i},metadata:function(){return s},toc:function(){return p}});var t=n(7462),a=n(3366),l=(n(7294),n(3905)),o=["components"],i={name:"ORM \u4f7f\u7528",sort:2},m="ORM \u4f7f\u7528\u65b9\u6cd5",s={unversionedId:"mvc/model/orm",id:"mvc/model/orm",title:"ORM \u4f7f\u7528\u65b9\u6cd5",description:"beego/orm \u7684\u4f7f\u7528\u4f8b\u5b50",source:"@site/docs/mvc/model/orm.md",sourceDirName:"mvc/model",slug:"/mvc/model/orm",permalink:"/bee-docs/docs/mvc/model/orm",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/mvc/model/orm.md",tags:[],version:"current",frontMatter:{name:"ORM \u4f7f\u7528",sort:2},sidebar:"tutorialSidebar",previous:{title:"\u5bf9\u8c61\u7684 CRUD \u64cd\u4f5c",permalink:"/bee-docs/docs/mvc/model/object"},next:{title:"\u6a21\u578b\uff08Models\uff09\uff0d beego ORM",permalink:"/bee-docs/docs/mvc/model/overview"}},u={},p=[{value:"models.go:",id:"modelsgo",level:5},{value:"main.go",id:"maingo",level:5},{value:"\u6570\u636e\u5e93\u7684\u8bbe\u7f6e",id:"\u6570\u636e\u5e93\u7684\u8bbe\u7f6e",level:2},{value:"RegisterDriver",id:"registerdriver",level:4},{value:"RegisterDataBase",id:"registerdatabase",level:4},{value:"SetMaxIdleConns",id:"setmaxidleconns",level:4},{value:"SetMaxOpenConns",id:"setmaxopenconns",level:4},{value:"\u65f6\u533a\u8bbe\u7f6e",id:"\u65f6\u533a\u8bbe\u7f6e",level:4},{value:"\u6ce8\u518c\u6a21\u578b",id:"\u6ce8\u518c\u6a21\u578b",level:2},{value:"RegisterModel",id:"registermodel",level:4},{value:"RegisterModelWithPrefix",id:"registermodelwithprefix",level:4},{value:"NewOrmWithDB",id:"newormwithdb",level:4},{value:"GetDB",id:"getdb",level:4},{value:"ResetModelCache",id:"resetmodelcache",level:4},{value:"ORM \u63a5\u53e3\u4f7f\u7528",id:"orm-\u63a5\u53e3\u4f7f\u7528",level:2},{value:"QueryTable",id:"querytable",level:4},{value:"Using",id:"using",level:4},{value:"Raw",id:"raw",level:4},{value:"Driver",id:"driver",level:4},{value:"\u8c03\u8bd5\u6a21\u5f0f\u6253\u5370\u67e5\u8be2\u8bed\u53e5",id:"\u8c03\u8bd5\u6a21\u5f0f\u6253\u5370\u67e5\u8be2\u8bed\u53e5",level:2}],d={toc:p};function c(e){var r=e.components,n=(0,a.Z)(e,o);return(0,l.kt)("wrapper",(0,t.Z)({},d,n,{components:r,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"orm-\u4f7f\u7528\u65b9\u6cd5"},"ORM \u4f7f\u7528\u65b9\u6cd5"),(0,l.kt)("p",null,"beego/orm \u7684\u4f7f\u7528\u4f8b\u5b50"),(0,l.kt)("p",null,"\u540e\u6587\u4f8b\u5b50\u5982\u65e0\u7279\u6b8a\u8bf4\u660e\u90fd\u4ee5\u8fd9\u4e2a\u4e3a\u57fa\u7840\u3002"),(0,l.kt)("p",null,"\u6ce8\u610f\u7684\u662f\uff0cv2.x\u548cv1.x\u5728 ORM \u4e0a\u6709\u4e00\u4e2a\u6781\u5927\u7684\u4e0d\u540c\uff0c\u5373v2.x\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"ORM"),"\u5bf9\u8c61\u88ab\u8bbe\u8ba1\u4e3a\u65e0\u72b6\u6001\u7684\uff0c\u56e0\u800c\u5929\u7136\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002"),(0,l.kt)("p",null,"\u4e5f\u56e0\u6b64\uff0c\u6211\u4eec\u5efa\u8bae\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e2a\u6570\u636e\u5e93\u5e94\u8be5\u53ea\u5b58\u5728\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"ORM"),"\u5bf9\u8c61\u3002"),(0,l.kt)("h5",{id:"modelsgo"},"models.go:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "github.com/beego/beego/v2/client/orm"\n)\n\ntype User struct {\n    Id          int\n    Name        string\n    Profile     *Profile   `orm:"rel(one)"` // OneToOne relation\n    Post        []*Post `orm:"reverse(many)"` // \u8bbe\u7f6e\u4e00\u5bf9\u591a\u7684\u53cd\u5411\u5173\u7cfb\n}\n\ntype Profile struct {\n    Id          int\n    Age         int16\n    User        *User   `orm:"reverse(one)"` // \u8bbe\u7f6e\u4e00\u5bf9\u4e00\u53cd\u5411\u5173\u7cfb(\u53ef\u9009)\n}\n\ntype Post struct {\n    Id    int\n    Title string\n    User  *User  `orm:"rel(fk)"`    //\u8bbe\u7f6e\u4e00\u5bf9\u591a\u5173\u7cfb\n    Tags  []*Tag `orm:"rel(m2m)"`\n}\n\ntype Tag struct {\n    Id    int\n    Name  string\n    Posts []*Post `orm:"reverse(many)"` //\u8bbe\u7f6e\u591a\u5bf9\u591a\u53cd\u5411\u5173\u7cfb\n}\n\nfunc init() {\n    // \u9700\u8981\u5728init\u4e2d\u6ce8\u518c\u5b9a\u4e49\u7684model\n    orm.RegisterModel(new(User), new(Post), new(Profile), new(Tag))\n}\n')),(0,l.kt)("h5",{id:"maingo"},"main.go"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "fmt"\n    "github.com/beego/beego/v2/client/orm"\n    _ "github.com/go-sql-driver/mysql"\n)\n\nfunc init() {\n    orm.RegisterDriver("mysql", orm.DRMySQL)\n\n    orm.RegisterDataBase("default", "mysql", "root:root@/orm_test?charset=utf8")\n}\n\nfunc main() {\n\n    // \u9ed8\u8ba4\u4f7f\u7528 default\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u4e3a\u5176\u4ed6\u6570\u636e\u5e93\n    o := orm.NewOrm()\n\n    profile := new(Profile)\n    profile.Age = 30\n\n    user := new(User)\n    user.Profile = profile\n    user.Name = "slene"\n\n    fmt.Println(o.Insert(profile))\n    fmt.Println(o.Insert(user))\n}\n')),(0,l.kt)("h2",{id:"\u6570\u636e\u5e93\u7684\u8bbe\u7f6e"},"\u6570\u636e\u5e93\u7684\u8bbe\u7f6e"),(0,l.kt)("p",null,"\u76ee\u524d ORM \u652f\u6301\u591a\u79cd\u6570\u636e\u5e93\uff0c\u4ee5\u4e0b\u4e3a\u6d4b\u8bd5\u8fc7\u7684 driver"),(0,l.kt)("p",null,"\u5c06\u4f60\u9700\u8981\u4f7f\u7528\u7684 driver \u52a0\u5165 import \u4e2d"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'import (\n    _ "github.com/go-sql-driver/mysql"\n    _ "github.com/lib/pq"\n    _ "github.com/mattn/go-sqlite3"\n)\n')),(0,l.kt)("h4",{id:"registerdriver"},"RegisterDriver"),(0,l.kt)("p",null,"\u9ed8\u8ba4\u6570\u636e\u5e93\u7c7b\u578b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"\norm.DRMySQL\norm.DRSqlite\norm.DRPostgres\norm.DRTiDB\n\n// < 1.6\norm.DR_MySQL\norm.DR_Sqlite\norm.DR_Postgres\n\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'// \u53c2\u65701   driverName\n// \u53c2\u65702   \u6570\u636e\u5e93\u7c7b\u578b\n// \u8fd9\u4e2a\u7528\u6765\u8bbe\u7f6e driverName \u5bf9\u5e94\u7684\u6570\u636e\u5e93\u7c7b\u578b\n// mysql / sqlite3 / postgres / tidb \u8fd9\u51e0\u79cd\u662f\u9ed8\u8ba4\u5df2\u7ecf\u6ce8\u518c\u8fc7\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u65e0\u9700\u8bbe\u7f6e\norm.RegisterDriver("mysql", orm.DRMySQL)\n')),(0,l.kt)("h4",{id:"registerdatabase"},"RegisterDataBase"),(0,l.kt)("p",null,"ORM \u5fc5\u987b\u6ce8\u518c\u4e00\u4e2a\u522b\u540d\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"default")," \u7684\u6570\u636e\u5e93\uff0c\u4f5c\u4e3a\u9ed8\u8ba4\u4f7f\u7528\u3002"),(0,l.kt)("p",null,"ORM \u4f7f\u7528 golang \u81ea\u5df1\u7684\u8fde\u63a5\u6c60"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'// \u53c2\u65701        \u6570\u636e\u5e93\u7684\u522b\u540d\uff0c\u7528\u6765\u5728 ORM \u4e2d\u5207\u6362\u6570\u636e\u5e93\u4f7f\u7528\n// \u53c2\u65702        driverName\n// \u53c2\u65703        \u5bf9\u5e94\u7684\u94fe\u63a5\u5b57\u7b26\u4e32\norm.RegisterDataBase("default", "mysql", "root:root@/orm_test?charset=utf8")\n\n// \u53c2\u65704(\u53ef\u9009)  \u8bbe\u7f6e\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\n// \u53c2\u65705(\u53ef\u9009)  \u8bbe\u7f6e\u6700\u5927\u6570\u636e\u5e93\u8fde\u63a5 (go >= 1.2)\nmaxIdle := 30\nmaxConn := 30\norm.RegisterDataBase("default", "mysql", "root:root@/orm_test?charset=utf8", orm.MaxIdleConnections(maxIdle), orm.MaxOpenConnections(maxConn))\n')),(0,l.kt)("h4",{id:"setmaxidleconns"},"SetMaxIdleConns"),(0,l.kt)("p",null,"\u6839\u636e\u6570\u636e\u5e93\u7684\u522b\u540d\uff0c\u8bbe\u7f6e\u6570\u636e\u5e93\u7684\u6700\u5927\u7a7a\u95f2\u8fde\u63a5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'orm.SetMaxIdleConns("default", 30)\n')),(0,l.kt)("h4",{id:"setmaxopenconns"},"SetMaxOpenConns"),(0,l.kt)("p",null,"\u6839\u636e\u6570\u636e\u5e93\u7684\u522b\u540d\uff0c\u8bbe\u7f6e\u6570\u636e\u5e93\u7684\u6700\u5927\u6570\u636e\u5e93\u8fde\u63a5 (go >= 1.2)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'orm.SetMaxOpenConns("default", 30)\n')),(0,l.kt)("h4",{id:"\u65f6\u533a\u8bbe\u7f6e"},"\u65f6\u533a\u8bbe\u7f6e"),(0,l.kt)("p",null,"ORM \u9ed8\u8ba4\u4f7f\u7528 time.Local \u672c\u5730\u65f6\u533a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4f5c\u7528\u4e8e ORM \u81ea\u52a8\u521b\u5efa\u7684\u65f6\u95f4"),(0,l.kt)("li",{parentName:"ul"},"\u4ece\u6570\u636e\u5e93\u4e2d\u53d6\u56de\u7684\u65f6\u95f4\u8f6c\u6362\u6210 ORM \u672c\u5730\u65f6\u95f4")),(0,l.kt)("p",null,"\u5982\u679c\u9700\u8981\u7684\u8bdd\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8fdb\u884c\u66f4\u6539"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"// \u8bbe\u7f6e\u4e3a UTC \u65f6\u95f4\norm.DefaultTimeLoc = time.UTC\n")),(0,l.kt)("p",null,"ORM \u5728\u8fdb\u884c RegisterDataBase \u7684\u540c\u65f6\uff0c\u4f1a\u83b7\u53d6\u6570\u636e\u5e93\u4f7f\u7528\u7684\u65f6\u533a\uff0c\u7136\u540e\u5728 time.Time \u7c7b\u578b\u5b58\u53d6\u65f6\u505a\u76f8\u5e94\u8f6c\u6362\uff0c\u4ee5\u5339\u914d\u65f6\u95f4\u7cfb\u7edf\uff0c\u4ece\u800c\u4fdd\u8bc1\u65f6\u95f4\u4e0d\u4f1a\u51fa\u9519\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6ce8\u610f:")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u9274\u4e8e Sqlite3 \u7684\u8bbe\u8ba1\uff0c\u5b58\u53d6\u9ed8\u8ba4\u90fd\u4e3a UTC \u65f6\u95f4"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528 go-sql-driver \u9a71\u52a8\u65f6\uff0c\u8bf7\u6ce8\u610f\u53c2\u6570\u8bbe\u7f6e\n\u4ece\u67d0\u4e00\u7248\u672c\u5f00\u59cb\uff0c\u9a71\u52a8\u9ed8\u8ba4\u4f7f\u7528 UTC \u65f6\u95f4\uff0c\u800c\u975e\u672c\u5730\u65f6\u95f4\uff0c\u6240\u4ee5\u8bf7\u6307\u5b9a\u65f6\u533a\u53c2\u6570\u6216\u8005\u5168\u90e8\u4ee5 UTC \u65f6\u95f4\u5b58\u53d6\n\u4f8b\u5982\uff1a",(0,l.kt)("inlineCode",{parentName:"li"},"root:root@/orm_test?charset=utf8&loc=Asia%2FShanghai"),"\n\u53c2\u89c1 ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/go-sql-driver/mysql#loc"},"loc")," / ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/go-sql-driver/mysql#parsetime"},"parseTime"))),(0,l.kt)("h2",{id:"\u6ce8\u518c\u6a21\u578b"},"\u6ce8\u518c\u6a21\u578b"),(0,l.kt)("p",null,"\u5982\u679c\u4f7f\u7528 orm.QuerySeter \u8fdb\u884c\u9ad8\u7ea7\u67e5\u8be2\u7684\u8bdd\uff0c\u8fd9\u4e2a\u662f\u5fc5\u987b\u7684\u3002"),(0,l.kt)("p",null,"\u53cd\u4e4b\uff0c\u5982\u679c\u53ea\u4f7f\u7528 Raw \u67e5\u8be2\u548c map struct\uff0c\u662f\u65e0\u9700\u8fd9\u4e00\u6b65\u7684\u3002\u60a8\u53ef\u4ee5\u53bb\u67e5\u770b ",(0,l.kt)("a",{parentName:"p",href:"/bee-docs/docs/mvc/model/rawsql"},"Raw SQL \u67e5\u8be2")),(0,l.kt)("h4",{id:"registermodel"},"RegisterModel"),(0,l.kt)("p",null,"\u5c06\u4f60\u5b9a\u4e49\u7684 Model \u8fdb\u884c\u6ce8\u518c\uff0c\u6700\u4f73\u8bbe\u8ba1\u662f\u6709\u5355\u72ec\u7684 models.go \u6587\u4ef6\uff0c\u5728\u4ed6\u7684 init \u51fd\u6570\u4e2d\u8fdb\u884c\u6ce8\u518c\u3002"),(0,l.kt)("p",null,"\u8ff7\u4f60\u7248 models.go"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport "github.com/beego/beego/v2/client/orm"\n\ntype User struct {\n    Id   int\n    Name string\n}\n\nfunc init(){\n    orm.RegisterModel(new(User))\n}\n')),(0,l.kt)("p",null,"RegisterModel \u4e5f\u53ef\u4ee5\u540c\u65f6\u6ce8\u518c\u591a\u4e2a model"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"orm.RegisterModel(new(User), new(Profile), new(Post))\n")),(0,l.kt)("p",null,"\u8be6\u7ec6\u7684 struct \u5b9a\u4e49\u8bf7\u67e5\u770b\u6587\u6863 ",(0,l.kt)("a",{parentName:"p",href:"/bee-docs/docs/mvc/model/models"},"\u6a21\u578b\u5b9a\u4e49")),(0,l.kt)("h4",{id:"registermodelwithprefix"},"RegisterModelWithPrefix"),(0,l.kt)("p",null,"\u4f7f\u7528\u8868\u540d\u524d\u7f00"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'orm.RegisterModelWithPrefix("prefix_", new(User))\n')),(0,l.kt)("p",null,"\u521b\u5efa\u540e\u7684\u8868\u540d\u4e3a prefix_user"),(0,l.kt)("h4",{id:"newormwithdb"},"NewOrmWithDB"),(0,l.kt)("p",null,"\u6709\u65f6\u5019\u9700\u8981\u81ea\u884c\u7ba1\u7406\u8fde\u63a5\u6c60\u4e0e\u6570\u636e\u5e93\u94fe\u63a5\uff08\u6bd4\u5982\uff1ago \u7684\u94fe\u63a5\u6c60\u65e0\u6cd5\u8ba9\u4e24\u6b21\u67e5\u8be2\u4f7f\u7528\u540c\u4e00\u4e2a\u94fe\u63a5\u7684\uff09"),(0,l.kt)("p",null,"\u4f46\u53c8\u60f3\u4f7f\u7528 ORM \u7684\u67e5\u8be2\u529f\u80fd"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"var driverName, aliasName string\n// driverName \u662f\u9a71\u52a8\u7684\u540d\u79f0\n// aliasName \u662f\u5f53\u524d db \u7684\u81ea\u5b9a\u4e49\u522b\u540d\nvar db *sql.DB\n...\no := orm.NewOrmWithDB(driverName, aliasName, db)\n")),(0,l.kt)("h4",{id:"getdb"},"GetDB"),(0,l.kt)("p",null,"\u4ece\u5df2\u6ce8\u518c\u7684\u6570\u636e\u5e93\u8fd4\u56de *sql.DB \u5bf9\u8c61\uff0c\u9ed8\u8ba4\u8fd4\u56de\u522b\u540d\u4e3a default \u7684\u6570\u636e\u5e93\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'db, err := orm.GetDB()\nif err != nil {\n    fmt.Println("get default DataBase")\n}\n\ndb, err := orm.GetDB("alias")\nif err != nil {\n    fmt.Println("get alias DataBase")\n}\n')),(0,l.kt)("h4",{id:"resetmodelcache"},"ResetModelCache"),(0,l.kt)("p",null,"\u91cd\u7f6e\u5df2\u7ecf\u6ce8\u518c\u7684\u6a21\u578b struct\uff0c\u4e00\u822c\u7528\u4e8e\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"orm.ResetModelCache()\n")),(0,l.kt)("h2",{id:"orm-\u63a5\u53e3\u4f7f\u7528"},"ORM \u63a5\u53e3\u4f7f\u7528"),(0,l.kt)("p",null,"\u4f7f\u7528 ORM \u5fc5\u7136\u63a5\u89e6\u7684 Ormer \u63a5\u53e3\uff0c\u6211\u4eec\u6765\u719f\u6089\u4e00\u4e0b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"var o orm.Ormer\no = orm.NewOrm() // \u521b\u5efa\u4e00\u4e2a Ormer\n// NewOrm \u7684\u540c\u65f6\u4f1a\u6267\u884c orm.BootStrap (\u6574\u4e2a app \u53ea\u6267\u884c\u4e00\u6b21)\uff0c\u7528\u4ee5\u9a8c\u8bc1\u6a21\u578b\u4e4b\u95f4\u7684\u5b9a\u4e49\u5e76\u7f13\u5b58\u3002\n")),(0,l.kt)("p",null,"\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u3002"),(0,l.kt)("p",null,"\u4f46\u662f\u5728\u4f7f\u7528\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4f1a\u8fd4\u56de",(0,l.kt)("inlineCode",{parentName:"p"},"TxOrm"),"\u7684\u5b9e\u4f8b\u3002\u8bf7\u53c2\u8003",(0,l.kt)("a",{parentName:"p",href:"/bee-docs/docs/mvc/model/transaction"},"orm \u4e8b\u52a1")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u548c v1.x \u6bd4\u8d77\u6765\uff0c\u6211\u4eec\u5728\u4e8b\u52a1\u4e0a\u91cd\u65b0\u8bbe\u8ba1\u4e86\u4e00\u756a\uff0c\u4ee5\u89c4\u907f\u76f8\u5f53\u591a\u7528\u6237\u90fd\u4f1a\u72af\u7684\u9519\u2014\u2014\u5373\u590d\u7528\u5168\u5c40\u7684 orm \u5bf9\u8c61\u6765\u64cd\u4f5c\u4e8b\u52a1\u3002"),(0,l.kt)("p",{parentName:"blockquote"},"\u8fd9\u4f53\u73b0\u4e86\u6211\u4eec\u7684\u4e00\u4e2a\u65b0\u7684\u8ba4\u77e5\u2014\u2014\u5373\uff0c\u6211\u4eec\u8ba4\u4e3a orm \u5bf9\u8c61\u5e94\u8be5\u662f\u4e00\u79cd\u65e0\u72b6\u6001\u7684\u5bf9\u8c61\u3002"),(0,l.kt)("p",{parentName:"blockquote"},"\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u6211\u4eec\u73b0\u5728\u63a8\u8350\u5927\u5bb6\u4fdd\u5b58\u5168\u5c40\u7684 orm \u5bf9\u8c61\u3002\u800c\u4e8b\u52a1orm \u5bf9\u8c61\uff0c\u5373 TxOrm \u7684\u5b9e\u4f8b\uff0c\u5219\u5e94\u8be5\u6bcf\u6b21\u4f7f\u7528\u5b8c\u6bd5\u5c31\u4e22\u5f03\u3002")),(0,l.kt)("h4",{id:"querytable"},"QueryTable"),(0,l.kt)("p",null,"\u4f20\u5165\u8868\u540d\uff0c\u6216\u8005 Model \u5bf9\u8c61\uff0c\u8fd4\u56de\u4e00\u4e2a ",(0,l.kt)("a",{parentName:"p",href:"/bee-docs/docs/mvc/model/query"},"QuerySeter")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'o := orm.NewOrm()\nvar qs orm.QuerySeter\nqs = o.QueryTable("user")\n// \u5982\u679c\u8868\u6ca1\u6709\u5b9a\u4e49\u8fc7\uff0c\u4f1a\u7acb\u523b panic\n')),(0,l.kt)("h4",{id:"using"},"Using"),(0,l.kt)("p",null,"\u6211\u4eec\u7684 v2.x \u79fb\u9664\u4e86\u8fd9\u4e2a\u65b9\u6cd5\u3002\u56e0\u4e3a v1.x \u7684\u4e00\u4e9b\u7528\u6237\u53cd\u9988\uff0c\u8be5\u65b9\u6cd5\u5bb9\u6613\u88ab\u7a0b\u5e8f\u5458\u8bef\u7528\u3002"),(0,l.kt)("p",null,"\u5728\u4e0d\u6070\u5f53\u7684\u5207\u6362\u6570\u636e\u5e93\u7684\u65f6\u5019\uff0c\u4f1a\u5bfc\u81f4\u4f7f\u7528\u76f8\u540c orm \u5b9e\u4f8b\u7684\u5176\u4f59\u4ee3\u7801\u5d29\u6e83\u3002"),(0,l.kt)("p",null,"\u60f3\u8c61\u4e00\u4e0b\uff0c\u4f60\u6709\u4e00\u6bb5\u4ee3\u7801\u672c\u6765\u53ea\u662f\u60f3\u7528 A \u6570\u636e\u5e93\u7684\uff0c\u7ed3\u679c\u53e6\u5916\u4e00\u6bb5\u4ee3\u7801\u5207\u6362\u5230\u4e86 B \u6570\u636e\u5e93\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u63a8\u8350\u4f7f\u7528\u53e6\u5916\u4e00\u4e2a\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'o := orm.NewOrmUsingDB("db_name")\n')),(0,l.kt)("p",null,"\u6b63\u5982\u524d\u9762\u63d0\u53ca\u7684\uff0c\u6211\u4eec\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u5c3d\u91cf\u590d\u7528 orm \u5b9e\u4f8b\u3002"),(0,l.kt)("h4",{id:"raw"},"Raw"),(0,l.kt)("p",null,"\u4f7f\u7528 sql \u8bed\u53e5\u76f4\u63a5\u8fdb\u884c\u64cd\u4f5c"),(0,l.kt)("p",null,"Raw \u51fd\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a ",(0,l.kt)("a",{parentName:"p",href:"/bee-docs/docs/mvc/model/rawsql"},"RawSeter")," \u7528\u4ee5\u5bf9\u8bbe\u7f6e\u7684 sql \u8bed\u53e5\u548c\u53c2\u6570\u8fdb\u884c\u64cd\u4f5c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'o := orm.NewOrm()\nvar r orm.RawSeter\nr = o.Raw("UPDATE user SET name = ? WHERE name = ?", "testing", "slene")\n')),(0,l.kt)("h4",{id:"driver"},"Driver"),(0,l.kt)("p",null,"\u8fd4\u56de\u5f53\u524d ORM \u4f7f\u7528\u7684 db \u4fe1\u606f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"type Driver interface {\n    Name() string\n    Type() DriverType\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'orm.RegisterDataBase("db1", "mysql", "root:root@/orm_db2?charset=utf8")\norm.RegisterDataBase("db2", "sqlite3", "data.db")\n\no1 := orm.NewOrmUsingDB("db1")\ndr := o1.Driver()\nfmt.Println(dr.Name() == "db1") // true\nfmt.Println(dr.Type() == orm.DRMySQL) // true\n\no2 := orm.NewOrmUsingDB("db2")\ndr = o2.Driver()\nfmt.Println(dr.Name() == "db2") // true\nfmt.Println(dr.Type() == orm.DRSqlite) // true\n')),(0,l.kt)("h2",{id:"\u8c03\u8bd5\u6a21\u5f0f\u6253\u5370\u67e5\u8be2\u8bed\u53e5"},"\u8c03\u8bd5\u6a21\u5f0f\u6253\u5370\u67e5\u8be2\u8bed\u53e5"),(0,l.kt)("p",null,"\u7b80\u5355\u7684\u8bbe\u7f6e Debug \u4e3a true \u6253\u5370\u67e5\u8be2\u7684\u8bed\u53e5"),(0,l.kt)("p",null,"\u53ef\u80fd\u5b58\u5728\u6027\u80fd\u95ee\u9898\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u5728\u751f\u4ea7\u6a21\u5f0f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"func main() {\n    orm.Debug = true\n...\n")),(0,l.kt)("p",null,"\u9ed8\u8ba4\u4f7f\u7528 os.Stderr \u8f93\u51fa\u65e5\u5fd7\u4fe1\u606f"),(0,l.kt)("p",null,"\u6539\u53d8\u8f93\u51fa\u5230\u4f60\u81ea\u5df1\u7684 io.Writer"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"var w io.Writer\n...\n// \u8bbe\u7f6e\u4e3a\u4f60\u7684 io.Writer\n...\norm.DebugLog = orm.NewLog(w)\n")),(0,l.kt)("p",null,"\u65e5\u5fd7\u683c\u5f0f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"[ORM] - \u65f6\u95f4 - [Queries/\u6570\u636e\u5e93\u540d] - [\u6267\u884c\u64cd\u4f5c/\u6267\u884c\u65f6\u95f4] - [SQL\u8bed\u53e5] - \u4f7f\u7528\u6807\u70b9 `,` \u5206\u9694\u7684\u53c2\u6570\u5217\u8868 - \u6253\u5370\u9047\u5230\u7684\u9519\u8bef\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"[ORM] - 2013-08-09 13:18:16 - [Queries/default] - [    db.Exec /     0.4ms] - [INSERT INTO `user` (`name`) VALUES (?)] - `slene`\n[ORM] - 2013-08-09 13:18:16 - [Queries/default] - [    db.Exec /     0.5ms] - [UPDATE `user` SET `name` = ? WHERE `id` = ?] - `astaxie`, `14`\n[ORM] - 2013-08-09 13:18:16 - [Queries/default] - [db.QueryRow /     0.4ms] - [SELECT `id`, `name` FROM `user` WHERE `id` = ?] - `14`\n[ORM] - 2013-08-09 13:18:16 - [Queries/default] - [    db.Exec /     0.4ms] - [INSERT INTO `post` (`user_id`,`title`,`content`) VALUES (?, ?, ?)] - `14`, `beego orm`, `powerful amazing`\n[ORM] - 2013-08-09 13:18:16 - [Queries/default] - [   db.Query /     0.4ms] - [SELECT T1.`name` `User__Name`, T0.`user_id` `User`, T1.`id` `User__Id` FROM `post` T0 INNER JOIN `user` T1 ON T1.`id` = T0.`user_id` WHERE T0.`id` = ? LIMIT 1000] - `68`\n[ORM] - 2013-08-09 13:18:16 - [Queries/default] - [    db.Exec /     0.4ms] - [DELETE FROM `user` WHERE `id` = ?] - `14`\n[ORM] - 2013-08-09 13:18:16 - [Queries/default] - [   db.Query /     0.3ms] - [SELECT T0.`id` FROM `post` T0 WHERE T0.`user_id` IN (?) ] - `14`\n[ORM] - 2013-08-09 13:18:16 - [Queries/default] - [    db.Exec /     0.4ms] - [DELETE FROM `post` WHERE `id` IN (?)] - `68`\n")),(0,l.kt)("p",null,"\u65e5\u5fd7\u5185\u5bb9\u5305\u62ec ",(0,l.kt)("strong",{parentName:"p"},"\u6240\u6709\u7684\u6570\u636e\u5e93\u64cd\u4f5c"),"\uff0c\u4e8b\u52a1\uff0cPrepare\uff0c\u7b49"))}c.isMDXComponent=!0}}]);